<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FIX: ƒê·ªïi t√™n ·ª©ng d·ª•ng -->
    <title>Ki·ªÉm tra h·ªçc k√¨ I - L·ªõp 10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #E0F7FA; /* Xanh da tr·ªùi r·∫•t nh·∫°t */
            color: #424242; /* X√°m ƒë·∫≠m */
            position: relative;
            overflow-x: hidden;
        }
        .safe-area { width: 100%; max-width: 85vw; margin-left: auto; margin-right: auto; }
        @media (max-width: 768px) { .safe-area { max-width: 95vw; } }
        .screen { display: none; }
        .screen.active { display: block; }
        .screen-transition { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Dropdown */
        .custom-select-options {
            transition: opacity 0.2s, transform 0.2s;
        }

        .option-card { transition: all 0.2s ease-in-out; }
        .option-card.selected { 
            background-color: #7986CB !important; /* Xanh indigo nh·∫π nh√†ng */
            color: white !important;
            border-color: #7986CB !important; 
            transform: translateY(-2px); 
            box-shadow: 0 4px 10px rgba(121, 134, 203, 0.4);
        }
        .tf-btn.selected { 
            outline: 2px solid #7986CB;
            outline-offset: 2px;
        }

        /* Review Screen Styles */
        .review-option.correct { background-color: #E8F5E9; border-color: #4CAF50; }
        .review-option.incorrect { background-color: #FFEBEE; border-color: #F44336; }
        .review-option.missed-correct { background-color: #E8F5E9; border: 2px dashed #4CAF50; }
        .review-tf-btn.correct { background-color: #4CAF50; color: white; }
        .review-tf-btn.incorrect { background-color: #F44336; color: white; }
    </style>
</head>
<body>

    <main class="w-full max-w-3xl mx-auto p-4 py-8">
        <!-- M√†n h√¨nh ƒêƒÉng nh·∫≠p -->
        <div id="login-screen" class="screen active">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10 safe-area">
                <div class="text-center mb-8">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">KI·ªÇM TRA H·ªåC K√å I NƒÇM H·ªåC 2025 ‚Äì 2026</h1>
                    <p class="text-base md:text-lg font-semibold text-gray-600 mt-2">M√îN: Tin h·ªçc ‚Äì L·ªöP: 10</p>
                    <p class="text-sm md:text-base text-[#5C6BC0] font-medium mt-2">Th·ªùi gian l√†m b√†i: 5 ph√∫t</p>
                </div>
                <div class="space-y-6">
                    <p class="text-center text-gray-700">Vui l√≤ng ch·ªçn ƒë√∫ng th√¥ng tin c·ªßa em ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
                    
                    <!-- Custom Select L·ªõp -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">1. Ch·ªçn l·ªõp</label>
                        <div class="relative">
                            <button type="button" id="class-select-button" class="w-full text-left px-4 py-3 bg-gray-50 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#7986CB] transition flex justify-between items-center">
                                <span class="text-gray-500">-- Vui l√≤ng ch·ªçn l·ªõp --</span>
                                <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div id="class-select-options" class="custom-select-options absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-xl shadow-lg hidden opacity-0 transform scale-95"></div>
                        </div>
                    </div>

                    <!-- Custom Select T√™n -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">2. Ch·ªçn t√™n c·ªßa em</label>
                        <div class="relative">
                             <button type="button" id="student-select-button" class="w-full text-left px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl transition flex justify-between items-center cursor-not-allowed" disabled>
                                <span class="text-gray-500">-- Vui l√≤ng ch·ªçn t√™n --</span>
                                <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div id="student-select-options" class="custom-select-options absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-xl shadow-lg hidden opacity-0 transform scale-95"></div>
                        </div>
                    </div>

                    <div class="pt-4">
                        <button id="start-button" class="w-full bg-[#7986CB] text-white font-bold py-3 px-4 rounded-xl hover:bg-[#5C6BC0] focus:outline-none focus:ring-4 focus:ring-[#C5CAE9] transition-all disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none shadow-lg shadow-indigo-500/30" disabled>B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√†n h√¨nh L√†m b√†i -->
        <div id="quiz-screen" class="screen">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 safe-area">
                <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
                    <span id="question-counter" class="font-bold text-lg text-[#3F51B5]"></span>
                    <div class="flex items-center space-x-2 bg-red-100 text-red-700 font-bold px-4 py-2 rounded-full">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span id="timer">05:00</span>
                    </div>
                </div>
                <div id="instruction-area" class="bg-indigo-50 p-4 rounded-lg mb-6 text-indigo-800 border border-indigo-200"></div>
                <div id="question-area">
                    <p id="question-text" class="text-lg font-semibold text-gray-800 mb-6"></p>
                    <div id="options-container" class="space-y-3"></div>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <button id="next-button" class="w-full bg-[#7986CB] text-white font-bold py-3 px-4 rounded-xl hover:bg-[#5C6BC0] focus:outline-none focus:ring-4 focus:ring-[#C5CAE9] transition-all disabled:bg-gray-400"></button>
                </div>
            </div>
        </div>
        
        <!-- M√†n h√¨nh K·∫øt qu·∫£ -->
        <div id="result-screen" class="screen">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10 safe-area screen-transition space-y-8">
                <div class="text-center">
                    <h2 class="text-4xl font-extrabold text-green-500">Ho√†n th√†nh!</h2>
                    <p id="result-greeting" class="mt-2 text-lg text-gray-700"></p>
                    <div class="mt-6 bg-gray-50 p-6 rounded-xl inline-block border border-gray-200">
                        <p class="text-sm font-medium text-gray-500">ƒêi·ªÉm s·ªë c·ªßa b·∫°n</p>
                        <p id="final-score" class="text-5xl font-extrabold text-[#3F51B5] my-1"></p>
                        <p id="time-taken" class="text-sm text-gray-600"></p>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="copy-button" class="bg-gray-700 text-white font-bold py-2 px-5 rounded-lg hover:bg-gray-800 transition-all duration-200 inline-block">Sao ch√©p k·∫øt qu·∫£</button>
                        <p id="copy-feedback" class="text-sm text-green-600 mt-2 opacity-0 transition-opacity">ƒê√£ sao ch√©p th√†nh c√¥ng!</p>
                    </div>
                </div>
                <div class="bg-indigo-50 p-5 rounded-xl border border-indigo-200">
                    <h3 class="text-xl font-bold text-indigo-800 mb-3">Nh·∫≠n x√©t b√†i l√†m</h3>
                    <div id="feedback-content" class="text-indigo-900 space-y-4"></div>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Xem l·∫°i b√†i l√†m</h3>
                    <div id="review-container" class="space-y-6"></div>
                </div>
                <div class="text-center pt-6 border-t border-gray-200">
                    <button id="end-button" class="bg-red-500 text-white font-bold py-3 px-8 rounded-xl hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 transition-all">K·∫øt th√∫c</button>
                </div>
            </div>
        </div>
    </main>

    <script>
    // --- CSDL M√î PH·ªéNG ---
    const studentData = { "10A1": ["Nguy·ªÖn VƒÉn A", "Tr·∫ßn Th·ªã B", "Ph·∫°m VƒÉn C", "B√πi Th·ªã H·ªìng Thu", "Nguy·ªÖn T√¥ S∆°n"], "10A2": ["L√™ Th·ªã D", "Ho√†ng VƒÉn E", "V≈© Th·ªã F"] };
    const quizData = {
        mc: [
            { id: 1, topic: "Python: V√≤ng l·∫∑p", question: "Ph∆∞∆°ng √°n n√†o d∆∞·ªõi ƒë√¢y m√¥ t·∫£ s·ª± kh√°c bi·ªát gi·ªØa c√¢u l·ªánh l·∫∑p for v√† while trong Python?", options: ["C√¢u l·ªánh for ƒë∆∞·ª£c s·ª≠ d·ª•ng khi s·ªë l·∫ßn l·∫∑p kh√¥ng x√°c ƒë·ªãnh, c√≤n while ƒë∆∞·ª£c s·ª≠ d·ª•ng khi s·ªë l·∫ßn l·∫∑p ƒë√£ bi·∫øt.", "C√¢u l·ªánh for ƒë∆∞·ª£c s·ª≠ d·ª•ng khi bi·∫øt s·ªë l·∫ßn l·∫∑p v√† c√≥ th·ªÉ l·∫∑p qua m·ªôt d√£y gi√° tr·ªã, trong khi while kh√¥ng bi·∫øt tr∆∞·ªõc s·ªë l·∫ßn l·∫∑p, l·∫∑p khi ƒëi·ªÅu ki·ªán ti·∫øp t·ª•c ƒë∆∞·ª£c th·ªèa m√£n.", "C·∫£ for v√† while ƒë·ªÅu d√πng ƒë·ªÉ l·∫∑p qua m·ªôt d√¢y gi√° tr·ªã x√°c ƒë·ªãnh.", "C√¢u l·ªánh for kh√¥ng th·ªÉ l·∫∑p v√¥ h·∫°n, trong khi while c√≥ th·ªÉ."], answer: 1 },
            { id: 2, topic: "Python: H√†m & Th∆∞ vi·ªán", question: "Khi g·ªçi m·ªôt h√†m c√≥ tham s·ªë nh∆∞ng kh√¥ng g√°n gi√° tr·ªã m·∫∑c ƒë·ªãnh cho tham s·ªë th√¨ ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra d∆∞·ªõi ƒë√¢y n·∫øu kh√¥ng truy·ªÅn ƒë·ªß s·ªë l∆∞·ª£ng ƒë·ªëi s·ªë cho tham s·ªë trong l·ªùi g·ªçi h√†m?", options: ["Python s·∫Ω t·ª± ƒë·ªông g√°n gi√° tr·ªã None cho c√°c tham s·ªë thi·∫øu.", "Ch∆∞∆°ng tr√¨nh s·∫Ω b√°o l·ªói TypeError.", "Ch∆∞∆°ng tr√¨nh b·ªè qua tham s·ªë thi·∫øu v√† ti·∫øp t·ª•c ch·∫°y.", "Python s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn gi√° tr·ªã m·∫∑c ƒë·ªãnh 0."], answer: 1 },
            { id: 3, topic: "Python: H√†m & Th∆∞ vi·ªán", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y ƒë√∫ng khi n√≥i v·ªÅ h√†m abs() trong Python?", options: ["H√†m abs() tr·∫£ v·ªÅ ph·∫ßn th·ª±c c·ªßa m·ªôt s·ªë ph·ª©c.", "H√†m abs() tr·∫£ v·ªÅ gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa m·ªôt s·ªë.", "H√†m abs() tr·∫£ v·ªÅ gi√° tr·ªã √¢m c·ªßa m·ªôt s·ªë.", "H√†m abs() tr·∫£ v·ªÅ ph·∫ßn nguy√™n c·ªßa m·ªôt s·ªë th·ª±c."], answer: 1 },
            { id: 4, topic: "Python: Chu·ªói & Danh s√°ch", question: "Khi s·ª≠ d·ª•ng h√†m len(s) v·ªõi m·ªôt x√¢u k√≠ t·ª± s, k·∫øt qu·∫£ tr·∫£ v·ªÅ l√† g√¨?", options: ["S·ªë k√≠ t·ª± trong x√¢u, bao g·ªìm c·∫£ d·∫•u c√°ch", "S·ªë l∆∞·ª£ng t·ª´ c√≥ trong x√¢u", "Ch·ªâ t√≠nh c√°c k√≠ t·ª± ch·ªØ c√°i trong x√¢u", "ƒê·ªô d√†i t·ªëi ƒëa m√† x√¢u c√≥ th·ªÉ ch·ª©a"], answer: 0 },
            { id: 5, topic: "Python: Chu·ªói & Danh s√°ch", question: "Cho ƒëo·∫°n l·ªánh Python sau:\ny = \"abcdef\"\nprint(y[:4])\nK·∫øt qu·∫£ n√†o sau ƒë√¢y l√† ƒë√∫ng khi th·ª±c hi·ªán ƒëo·∫°n l·ªánh tr√™n?", options: ["abcd", "bcde", "abc", "abcdef"], answer: 0 },
            { id: 6, topic: "Python: Chu·ªói & Danh s√°ch", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y m√¥ t·∫£ ƒë√∫ng c√°ch truy c·∫≠p ph·∫ßn t·ª≠ trong danh s√°ch A t·∫°i v·ªã tr√≠ ch·ªâ s·ªë 2?", options: ["A<2>", "A(2)", "A{2}", "A[2]"], answer: 3 },
            { id: 7, topic: "Python: Chu·ªói & Danh s√°ch", question: "Cho danh s√°ch sau:\nA = [\"apple\", \"banana\", \"cherry\", \"date\", \"elderberry\", \"fig\", \"grape\"]\nPh∆∞∆°ng √°n n√†o sau ƒë√¢y n√™u ƒë√∫ng gi√° tr·ªã c·ªßa ph·∫ßn t·ª≠ A[5]?", options: ["\"elderberry\"", "\"grape\"", "\"fig\"", "\"date\""], answer: 2 },
            { id: 8, topic: "L·∫≠p tr√¨nh: Kh√°i ni·ªám & G·ª° l·ªói", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y ƒëi·ªÅn t·ª´ ƒë√∫ng v√†o ch·ªó tr·ªëng:\n\"... l√† m·ªôt l·ªói khi ch∆∞∆°ng tr√¨nh kh√¥ng tu√¢n theo c√°c quy ƒë·ªãnh ng·ªØ ph√°p c·ªßa ng√¥n ng·ªØ l·∫≠p tr√¨nh\"?", options: ["L·ªói ng·ªØ nghƒ©a.", "L·ªói c√∫ ph√°p.", "L·ªói logic.", "L·ªói ngo·∫°i l·ªá."], answer: 1 },
            { id: 9, topic: "L·∫≠p tr√¨nh: Kh√°i ni·ªám & G·ª° l·ªói", question: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y gi·∫£i th√≠ch t·∫°i sao vi·ªác ki·ªÉm th·ª≠ ch∆∞∆°ng tr√¨nh l·∫°i quan tr·ªçng trong qu√° tr√¨nh l·∫≠p tr√¨nh?", options: ["Ki·ªÉm th·ª≠ gi√∫p ƒë·∫£m b·∫£o r·∫±ng ch∆∞∆°ng tr√¨nh ƒë√£ ho√†n ch·ªânh v√† c√≥ th·ªÉ ch·∫°y ngay l·∫≠p t·ª©c m√† kh√¥ng c·∫ßn thay ƒë·ªïi g√¨.", "Ki·ªÉm th·ª≠ gi√∫p x√°c ƒë·ªãnh l·ªói v√† ƒëi·ªÅu ch·ªânh ch∆∞∆°ng tr√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o k·∫øt qu·∫£ ƒë√∫ng v·ªõi y√™u c·∫ßu b√†i to√°n.", "Ki·ªÉm th·ª≠ kh√¥ng c·∫ßn thi·∫øt n·∫øu ch∆∞∆°ng tr√¨nh ch·∫°y ƒë√∫ng ·ªü l·∫ßn ƒë·∫ßu ti√™n.", "Ki·ªÉm th·ª≠ ch·ªâ c·∫ßn thi·∫øt khi ch∆∞∆°ng tr√¨nh ƒë√£ ho√†n th√†nh 100%."], answer: 1 },
            { id: 10, topic: "L·∫≠p tr√¨nh: Kh√°i ni·ªám & G·ª° l·ªói", question: "T·∫°i sao vi·ªác x√°c ƒë·ªãnh c√°ch t·ªï ch·ª©c d·ªØ li·ªáu l√† m·ªôt ph·∫ßn quan tr·ªçng trong b∆∞·ªõc t√¨m thu·∫≠t to√°n?", options: ["ƒê·ªÉ l√†m cho ch∆∞∆°ng tr√¨nh nhanh h∆°n m√† kh√¥ng c·∫ßn t√≠nh to√°n.", "ƒê·ªÉ ch·ªçn ƒë∆∞·ª£c ng√¥n ng·ªØ l·∫≠p tr√¨nh th√≠ch h·ª£p cho b√†i to√°n.", "ƒê·ªÉ ƒë·∫£m b·∫£o r·∫±ng thu·∫≠t to√°n c√≥ th·ªÉ ho·∫°t ƒë·ªông tr√™n c√°c c·∫•u tr√∫c d·ªØ li·ªáu ph√π h·ª£p.", "ƒê·ªÉ gi·∫£i quy·∫øt b√†i to√°n m√† kh√¥ng c·∫ßn ki·ªÉm th·ª≠ ch∆∞∆°ng tr√¨nh."], answer: 2 },
            { id: 11, topic: "Thi·∫øt k·∫ø ƒë·ªì h·ªça: GIMP", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y l√† vai tr√≤ c·ªßa ph·∫ßn m·ªÅm GIMP trong vi·ªác thi·∫øt k·∫ø ƒë·ªì h·ªça?", options: ["Qu·∫£n l√Ω c√°c t·ªáp ·∫£nh v√† l∆∞u tr·ªØ ch√∫ng", "Cung c·∫•p c√°c c√¥ng c·ª• thi·∫øt k·∫ø ƒë·ªì h·ªça nh∆∞ t·∫°o vƒÉn b·∫£n, t√¥ m√†u, gh√©p ·∫£nh", "T·∫°o ra c√°c ph·∫ßn m·ªÅm di ƒë·ªông", "H·ªó tr·ª£ ch·ªânh s·ª≠a video"], answer: 1 },
            { id: 12, topic: "Thi·∫øt k·∫ø ƒë·ªì h·ªça: GIMP", question: "Trong GIMP, n·∫øu m·ªôt ƒëi·ªÉm ·∫£nh c√≥ gi√° tr·ªã k√™nh alpha l√† 0 th√¨ ƒëi·ªÅu n√†y c√≥ nghƒ©a g√¨ sau ƒë√¢y?", options: ["ƒêi·ªÉm ·∫£nh ƒë√≥ c√≥ m√†u ƒëen.", "ƒêi·ªÉm ·∫£nh ƒë√≥ c√≥ m√†u tr·∫Øng.", "ƒêi·ªÉm ·∫£nh ƒë√≥ kh√¥ng hi·ªÉn th·ªã.", "ƒêi·ªÉm ·∫£nh ƒë√≥ hi·ªÉn th·ªã m·ªü."], answer: 2 }
        ],
        tf: [
            { id: 13, topic: "Python: H√†m & Th∆∞ vi·ªán", question: "Trong m·ªôt gi·ªù h·ªçc l·∫≠p tr√¨nh Python, th·∫ßy gi√°o gi·ªõi thi·ªáu cho c√°c b·∫°n h·ªçc sinh l·ªõp 10A v·ªÅ th∆∞ vi·ªán h√†m c√≥ s·∫µn. Mu·ªën s·ª≠ d·ª•ng c√°c h√†m n√†y ch·ªâ c·∫ßn k·∫øt n·ªëi h√†m ho·∫∑c th∆∞ vi·ªán ch·ª©a h√†m v·ªõi ch∆∞∆°ng tr√¨nh, g·ªçi ƒë·∫øn h√†m v√† truy·ªÅn v√†o gi√° tr·ªã cho c√°c tham s·ªë trong h√†m. C√°c b·∫°n h·ªçc sinh sau khi nghe ph√¢n t√≠ch c·ªßa th·∫ßy ƒë√£ ƒë∆∞a ra m·ªôt s·ªë nh·∫≠n x√©t sau:", options: [{ text: "Trong Python, th∆∞ vi·ªán l√† m·ªôt t·∫≠p h·ª£p g·ªìm m·ªôt s·ªë h√†m ƒë√£ ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn.", answer: "ƒê" }, { text: "C√°c h√†m c√≥ s·∫µn trong Python ƒë∆∞·ª£c s·ª≠ d·ª•ng lu√¥n trong ch∆∞∆°ng tr√¨nh, kh√¥ng c·∫ßn k·∫øt n·ªëi h√†m hay th∆∞ vi·ªán ch·ª©a h√†m v·ªõi ch∆∞∆°ng tr√¨nh.", answer: "S" }, { text: "Khi th·ª±c hi·ªán l·ªùi g·ªçi h√†m, b·∫•t k·ªÉ h√†m n√†o c≈©ng c·∫ßn truy·ªÅn v√†o gi√° tr·ªã cho tham s·ªë ƒë·ªÉ h√†m th·ª±c hi·ªán.", answer: "S" }, { text: "Python h·ªó tr·ª£ nhi·ªÅu h√†m c√≥ s·∫µn gi√∫p cho ng∆∞·ªùi l·∫≠p tr√¨nh vi·∫øt ch∆∞∆°ng tr√¨nh nhanh g·ªçn, kh√¥ng c·∫ßn ph·∫£i x√¢y d·ª±ng c√°c ƒëo·∫°n l·ªánh d√†i v√† ph·ª©c t·∫°p.", answer: "ƒê" }] },
            { id: 14, topic: "Python: Chu·ªói & Danh s√°ch", question: "M·ªôt nh√≥m h·ªçc sinh ƒëang th·ª±c hi·ªán b√†i t·∫≠p s·∫Øp x·∫øp danh s√°ch A c√°c ƒëi·ªÉm s·ªë c·ªßa m√¨nh trong Python. Sau khi nh·∫≠p c√°c ƒëi·ªÉm s·ªë v√†o danh s√°ch, nh√≥m h·ªçc sinh mu·ªën s·∫Øp x·∫øp c√°c ƒëi·ªÉm s·ªë theo th·ª© t·ª± tƒÉng d·∫ßn. C√°c b·∫°n h·ªçc sinh ƒë√£ ƒë∆∞a ra c√°c nh·∫≠n x√©t sau:", options: [{ text: "H√†m A.sort() ch·ªâ s·∫Øp x·∫øp danh s√°ch theo th·ª© t·ª± tƒÉng d·∫ßn.", answer: "S" }, { text: "H√†m A.sort() ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi c√°c danh s√°ch ch·ª©a c√°c ph·∫ßn t·ª≠ c√πng ki·ªÉu d·ªØ li·ªáu.", answer: "S" }, { text: "Khi th·ª±c hi·ªán s·∫Øp x·∫øp b·∫±ng h√†m A.sort(), danh s√°ch s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi tr·ª±c ti·∫øp v√† kh√¥ng c·∫ßn ph·∫£i g√°n l·∫°i gi√° tr·ªã cho danh s√°ch.", answer: "ƒê" }, { text: "ƒê·ªÉ s·∫Øp x·∫øp danh s√°ch ƒëi·ªÉm theo th·ª© t·ª± kh√¥ng gi·∫£m, c√≥ th·ªÉ d√πng l·ªánh A.sort().", answer: "ƒê" }] },
            { id: 15, topic: "L·∫≠p tr√¨nh: K·ªπ nƒÉng ngh·ªÅ nghi·ªáp", question: "M·ªôt c√¥ng ty c√¥ng ngh·ªá ƒëang t·ªï ch·ª©c h·ªôi th·∫£o v·ªÅ ngh·ªÅ l·∫≠p tr√¨nh ƒë·ªÉ tuy·ªÉn d·ª•ng nh√¢n s·ª± tr·∫ª. Sau khi tham gia h·ªôi th·∫£o, s·ªë ·ª©ng vi√™n ƒë√£ c√≥ nh·ªØng nh·∫≠n x√©t sau:", options: [{ text: "C√¥ng vi·ªác l·∫≠p tr√¨nh ch·ªâ li√™n quan ƒë·∫øn vi·ªác vi·∫øt m√£, kh√¥ng ƒë√≤i h·ªèi s·ª± ki√™n tr√¨ hay kh·∫£ nƒÉng ch·ªãu √°p l·ª±c.", answer: "S" }, { text: "Vi·ªác l·∫≠p tr√¨nh kh√¥ng ƒë∆°n gi·∫£n ch·ªâ l√† vi·∫øt m√£, m√† c√≤n bao g·ªìm g·ª° l·ªói, t·ªëi ∆∞u h√≥a v√† ki·ªÉm th·ª≠ ph·∫ßn m·ªÅm.", answer: "ƒê" }, { text: "L·∫≠p tr√¨nh vi√™n th∆∞·ªùng ph·∫£i l√†m vi·ªác v·ªõi nhi·ªÅu d·ª± √°n c√πng l√∫c v√† c√≥ th·ªùi h·∫°n ch·∫∑t ch·∫Ω.", answer: "ƒê" }, { text: "M·ªôt l·∫≠p tr√¨nh vi√™n gi·ªèi kh√¥ng ch·ªâ c·∫ßn k·ªπ nƒÉng chuy√™n m√¥n m√† c√≤n ph·∫£i c√≥ kh·∫£ nƒÉng giao ti·∫øp ƒë·ªÉ l√†m vi·ªác hi·ªáu qu·∫£ trong nh√≥m.", answer: "ƒê" }] },
            { id: 16, topic: "Thi·∫øt k·∫ø ƒë·ªì h·ªça: GIMP", question: "An ƒë∆∞·ª£c giao nhi·ªám v·ª• thi·∫øt k·∫ø logo cho c√¢u l·∫°c b·ªô Tin h·ªçc c·ªßa tr∆∞·ªùng b·∫±ng ph·∫ßn m·ªÅm GIMP. Logo g·ªìm h√¨nh ·∫£nh m·ªôt ch√∫ chim c√°nh c·ª•t ƒëang ƒë·ª©ng tr√™n qu·∫£ ƒë·ªãa c·∫ßu. An ƒë√£ v·∫Ω h√¨nh ch√∫ chim c√°nh c·ª•t tr√™n m·ªôt l·ªõp v√† h√¨nh qu·∫£ ƒë·ªãa c·∫ßu tr√™n m·ªôt l·ªõp kh√°c. Khi An mu·ªën di chuy·ªÉn h√¨nh ch√∫ chim c√°nh c·ª•t l√™n tr√™n m·ªôt ch√∫t so v·ªõi qu·∫£ ƒë·ªãa c·∫ßu, b·∫°n ·∫•y n√™n th·ª±c hi·ªán thao t√°c n√†o sau ƒë√¢y?", options: [{ text: "C√¥ng c·ª• Move Tool d√πng ƒë·ªÉ di chuy·ªÉn c√°c ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c ch·ªçn.", answer: "S" }, { text: "H√¨nh ch√∫ chim c√°nh c·ª•t v√† h√¨nh qu·∫£ ƒë·ªãa c·∫ßu n·∫±m tr√™n hai l·ªõp kh√°c nhau, do ƒë√≥ c√≥ th·ªÉ di chuy·ªÉn ƒë·ªôc l·∫≠p.", answer: "ƒê" }, { text: "C√≥ th·ªÉ di chuy·ªÉn ƒë·ªìng th·ªùi c·∫£ hai h√¨nh ·∫£nh c√πng l√∫c sang v·ªã tr√≠ kh√°c so v·ªõi ban ƒë·∫ßu b·∫±ng c√°ch nh√≥m hai l·ªõp l·∫°i v·ªõi nhau.", answer: "S" }, { text: "Mu·ªën di chuy·ªÉn h√¨nh ch√∫ chim c√°nh c·ª•t l√™n tr√™n m·ªôt ch√∫t so v·ªõi qu·∫£ ƒë·ªãa c·∫ßu, An kh√¥ng c·∫ßn di chuy·ªÉn l·ªõp, ch·ªâ c·∫ßn di chuy·ªÉn h√¨nh v·∫Ω ch√∫ chim c√°nh c·ª•t tr√™n l·ªõp ·∫£nh t∆∞∆°ng ·ª©ng.", answer: "S" }] }
        ]
    };

    const resourceMap = {
        "Python: V√≤ng l·∫∑p": {
            advice: "Em c·∫ßn ph√¢n bi·ªát r√µ khi n√†o d√πng `for` (khi bi·∫øt tr∆∞·ªõc s·ªë l·∫ßn l·∫∑p ho·∫∑c l·∫∑p qua m·ªôt danh s√°ch) v√† khi n√†o d√πng `while` (khi l·∫∑p theo m·ªôt ƒëi·ªÅu ki·ªán ch∆∞a bi·∫øt tr∆∞·ªõc).",
            links: [
                { title: "B√†i 13: V√≤ng l·∫∑p While, For (Ti·∫øng Vi·ªát)", url: "https://howkteam.com/lessons/cau-truc-lap-trong-python-while-for-break-continue-pass" },
                { title: "Python Loops (English)", url: "https://www.w3schools.com/python/python_while_loops.asp" },
                { title: "Video: V√≤ng l·∫∑p For & While (YouTube)", url: "https://www.youtube.com/watch?v=p33xCAt3vsc" }
            ]
        },
        "Python: H√†m & Th∆∞ vi·ªán": {
            advice: "H√£y xem l·∫°i c√°ch ƒë·ªãnh nghƒ©a h√†m, vi·ªác truy·ªÅn tham s·ªë b·∫Øt bu·ªôc v√† tham s·ªë t√πy ch·ªçn. Vi·ªác hi·ªÉu r√µ l·ªói `TypeError` khi thi·∫øu tham s·ªë l√† r·∫•t quan tr·ªçng.",
            links: [
                { title: "B√†i 15: H√†m trong Python (Ti·∫øng Vi·ªát)", url: "https://howkteam.com/lessons/ham-trong-python-function" },
                { title: "Python Functions (English)", url: "https://www.w3schools.com/python/python_functions.asp" },
                { title: "Video: T·∫•t t·∫ßn t·∫≠t v·ªÅ H√†m (YouTube)", url: "https://www.youtube.com/watch?v=I-n8_S-V6_o" }
            ]
        },
        "Python: Chu·ªói & Danh s√°ch": {
            advice: "Em c·∫ßn √¥n l·∫°i c√°ch truy c·∫≠p c√°c ph·∫ßn t·ª≠ trong chu·ªói v√† danh s√°ch b·∫±ng ch·ªâ s·ªë (index), bao g·ªìm c·∫£ c√°ch c·∫Øt chu·ªói/danh s√°ch (slicing) v√† c√°c h√†m th√¥ng d·ª•ng.",
            links: [
                { title: "B√†i 9: Ki·ªÉu d·ªØ li·ªáu List (Ti·∫øng Vi·ªát)", url: "https://howkteam.com/lessons/kieu-du-lieu-list-trong-python-va-cac-phuong-thuc-xu-ly" },
                { title: "Python Lists (English)", url: "https://www.w3schools.com/python/python_lists.asp" },
                { title: "Video: List v√† String trong Python (YouTube)", url: "https://www.youtube.com/watch?v=x16QYI-O2Ak" }
            ]
        },
        "L·∫≠p tr√¨nh: Kh√°i ni·ªám & G·ª° l·ªói": {
            advice: "Vi·ªác ph√¢n bi·ªát c√°c lo·∫°i l·ªói (c√∫ ph√°p, logic) v√† hi·ªÉu t·∫ßm quan tr·ªçng c·ªßa vi·ªác ki·ªÉm th·ª≠ l√† n·ªÅn t·∫£ng. H√£y ch·∫Øc ch·∫Øn em n·∫Øm r√µ c√°c kh√°i ni·ªám c∆° b·∫£n n√†y.",
            links: [
                { title: "C√°c kh√°i ni·ªám l·∫≠p tr√¨nh c∆° b·∫£n (Ti·∫øng Vi·ªát)", url: "https://blog.topcv.vn/cac-khai-niem-lap-trinh-co-ban/" },
                { title: "Debugging in Python (English)", url: "https://realpython.com/python-debugging-pdb/" },
                { title: "Video: Debugging l√† g√¨? (YouTube)", url: "https://www.youtube.com/watch?v=p8R4zdaA_gA" }
            ]
        },
        "Thi·∫øt k·∫ø ƒë·ªì h·ªça: GIMP": {
            advice: "Em c·∫ßn xem l·∫°i kh√°i ni·ªám v·ªÅ c√°c l·ªõp (layers) v√† k√™nh alpha (trong su·ªët) trong GIMP. ƒê√¢y l√† nh·ªØng ki·∫øn th·ª©c c·ªët l√µi ƒë·ªÉ ch·ªânh s·ª≠a ·∫£nh hi·ªáu qu·∫£.",
            links: [
                { title: "GIMP c∆° b·∫£n: L√†m vi·ªác v·ªõi Layer (Ti·∫øng Vi·ªát)", url: "https://quantrimang.com/gimp-co-ban-bai-6-lam-viec-voi-layer-126895" },
                { title: "GIMP Official Tutorials (English)", url: "https://www.gimp.org/tutorials/" },
                { title: "Video: H∆∞·ªõng d·∫´n GIMP cho ng∆∞·ªùi m·ªõi (YouTube)", url: "https://www.youtube.com/watch?v=s43_KqA_m44" }
            ]
        },
        "L·∫≠p tr√¨nh: K·ªπ nƒÉng ngh·ªÅ nghi·ªáp": {
            advice: "H√£y nh·ªõ r·∫±ng l·∫≠p tr√¨nh kh√¥ng ch·ªâ l√† vi·∫øt code. C√°c k·ªπ nƒÉng m·ªÅm nh∆∞ l√†m vi·ªác nh√≥m, giao ti·∫øp v√† qu·∫£n l√Ω th·ªùi gian c≈©ng v√¥ c√πng quan tr·ªçng.",
            links: [
                { title: "9 K·ªπ nƒÉng m·ªÅm IT c·∫ßn c√≥ (Ti·∫øng Vi·ªát)", url: "https://itviec.com/blog/9-ky-nang-mem-it-ban-can-biet/" },
                { title: "Essential Soft Skills for Developers (English)", url: "https://www.freecodecamp.org/news/soft-skills-for-software-developers/" },
                { title: "Video: K·ªπ nƒÉng m·ªÅm cho l·∫≠p tr√¨nh vi√™n (YouTube)", url: "https://www.youtube.com/watch?v=stq_I2pS_js" }
            ]
        }
    };

    // --- BI·∫æN TO√ÄN C·ª§C ---
    let shuffledQuestions = [], currentUser = { class: null, name: null }, userAnswers = [], completedStudents = [];
    let currentQuestionIndex = 0, timerInterval, timeRemaining = 5 * 60;

    // --- L·∫§Y C√ÅC TH√ÄNH PH·∫¶N GIAO DI·ªÜN ---
    const loginScreen = document.getElementById('login-screen'), quizScreen = document.getElementById('quiz-screen'), resultScreen = document.getElementById('result-screen');
    const classSelectBtn = document.getElementById('class-select-button'), studentSelectBtn = document.getElementById('student-select-button');
    const classSelectOptions = document.getElementById('class-select-options'), studentSelectOptions = document.getElementById('student-select-options');
    const startButton = document.getElementById('start-button');
    const questionCounter = document.getElementById('question-counter'), timerDisplay = document.getElementById('timer'), instructionArea = document.getElementById('instruction-area');
    const questionText = document.getElementById('question-text'), optionsContainer = document.getElementById('options-container'), nextButton = document.getElementById('next-button');
    const resultGreeting = document.getElementById('result-greeting'), finalScore = document.getElementById('final-score'), timeTakenEl = document.getElementById('time-taken');
    const copyButton = document.getElementById('copy-button'), copyFeedback = document.getElementById('copy-feedback'), feedbackContent = document.getElementById('feedback-content');
    const reviewContainer = document.getElementById('review-container'), endButton = document.getElementById('end-button');

    // --- LOGIC ---
    const shuffleArray = arr => { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; };
    const switchScreen = id => { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active', 'screen-transition')); const t = document.getElementById(id); if(t){ t.classList.add('active'); setTimeout(() => t.classList.add('screen-transition'), 10); } };

    // --- M√ÄN H√åNH ƒêƒÇNG NH·∫¨P (V·ªöI CUSTOM DROPDOWN) ---
    function toggleDropdown(optionsElement) {
        if (optionsElement.classList.contains('hidden')) {
            optionsElement.classList.remove('hidden');
            setTimeout(() => optionsElement.classList.remove('opacity-0', 'scale-95'), 10);
        } else {
            optionsElement.classList.add('opacity-0', 'scale-95');
            setTimeout(() => optionsElement.classList.add('hidden'), 200);
        }
    }

    function initLoginScreen() {
        switchScreen('login-screen');
        completedStudents = JSON.parse(localStorage.getItem('completedStudents_tin10_hk1')) || [];
        
        // Reset buttons
        classSelectBtn.firstElementChild.textContent = '-- Vui l√≤ng ch·ªçn l·ªõp --';
        classSelectBtn.firstElementChild.classList.add('text-gray-500');
        studentSelectBtn.firstElementChild.textContent = '-- Vui l√≤ng ch·ªçn t√™n --';
        studentSelectBtn.firstElementChild.classList.add('text-gray-500');
        studentSelectBtn.disabled = true;
        studentSelectBtn.classList.add('bg-gray-200', 'cursor-not-allowed');

        // Populate class options
        classSelectOptions.innerHTML = '';
        Object.keys(studentData).forEach(c => {
            const optionDiv = document.createElement('a');
            optionDiv.href = '#';
            optionDiv.className = 'block px-4 py-2 text-gray-700 hover:bg-indigo-50';
            optionDiv.textContent = `L·ªõp ${c}`;
            optionDiv.dataset.value = c;
            optionDiv.addEventListener('click', (e) => {
                e.preventDefault();
                handleClassChange(c, `L·ªõp ${c}`);
                toggleDropdown(classSelectOptions);
            });
            classSelectOptions.appendChild(optionDiv);
        });
    }

    function handleClassChange(classValue, classText) {
        currentUser.class = classValue;
        classSelectBtn.firstElementChild.textContent = classText;
        classSelectBtn.firstElementChild.classList.remove('text-gray-500');

        studentSelectOptions.innerHTML = '';
        studentSelectBtn.firstElementChild.textContent = '-- Vui l√≤ng ch·ªçn t√™n --';
        studentSelectBtn.firstElementChild.classList.add('text-gray-500');
        currentUser.name = null;

        if (classValue) {
            studentSelectBtn.disabled = false;
            studentSelectBtn.classList.remove('bg-gray-200', 'cursor-not-allowed');
            studentSelectBtn.classList.add('bg-gray-50');
            const students = studentData[classValue];
            students.forEach(studentName => {
                const studentId = `${classValue}-${studentName}`;
                if (!completedStudents.includes(studentId)) {
                    const optionDiv = document.createElement('a');
                    optionDiv.href = '#';
                    optionDiv.className = 'block px-4 py-2 text-gray-700 hover:bg-indigo-50';
                    optionDiv.textContent = studentName;
                    optionDiv.dataset.value = studentName;
                    optionDiv.addEventListener('click', (e) => {
                        e.preventDefault();
                        handleStudentChange(studentName);
                        toggleDropdown(studentSelectOptions);
                    });
                    studentSelectOptions.appendChild(optionDiv);
                }
            });
        } else {
            studentSelectBtn.disabled = true;
            studentSelectBtn.classList.add('bg-gray-200', 'cursor-not-allowed');
            studentSelectBtn.classList.remove('bg-gray-50');
        }
        updateStartState();
    }
    
    function handleStudentChange(studentName) {
        currentUser.name = studentName;
        studentSelectBtn.firstElementChild.textContent = studentName;
        studentSelectBtn.firstElementChild.classList.remove('text-gray-500');
        updateStartState();
    }

    const updateStartState = () => { startButton.disabled = !(currentUser.class && currentUser.name); };

    // --- M√ÄN H√åNH L√ÄM B√ÄI ---
    function startQuiz() {
        switchScreen('quiz-screen');
        const shuffledMC = shuffleArray([...quizData.mc]); const shuffledTF = shuffleArray([...quizData.tf]);
        shuffledQuestions = [...shuffledMC, ...shuffledTF];
        userAnswers = new Array(shuffledQuestions.length).fill(null);
        currentQuestionIndex = 0; timeRemaining = 5 * 60;
        startTimer(); displayQuestion();
    }
    
    function startTimer() {
        timerInterval = setInterval(() => {
            timeRemaining--;
            const minutes = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
            const seconds = (timeRemaining % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
            if (timeRemaining <= 0) { clearInterval(timerInterval); submitQuiz(); }
        }, 1000);
    }

    function displayQuestion() {
        nextButton.disabled = true;
        const questionData = shuffledQuestions[currentQuestionIndex];
        const totalQuestions = shuffledQuestions.length;
        const isMC = typeof questionData.options[0] === 'string';
        questionCounter.textContent = `C√¢u ${currentQuestionIndex + 1}/${totalQuestions}`;
        questionText.innerHTML = `<b class="text-[#3F51B5]">C√¢u ${currentQuestionIndex + 1}:</b> ${questionData.question.replace(/\n/g, '<br>')}`;
        optionsContainer.innerHTML = '';
        instructionArea.style.display = 'none';
        const mcCount = quizData.mc.length;
        if (currentQuestionIndex === 0) { instructionArea.innerHTML = `<h3 class="font-bold">Ph·∫ßn 1: Tr·∫Øc nghi·ªám nhi·ªÅu ph∆∞∆°ng √°n l·ª±a ch·ªçn</h3><p class="text-sm">T·ª´ c√¢u 1 ƒë·∫øn c√¢u ${mcCount}, m·ªói c√¢u h·ªçc sinh ch·ªâ ch·ªçn m·ªôt ph∆∞∆°ng √°n tr·∫£ l·ªùi.</p>`; instructionArea.style.display = 'block'; } 
        else if (currentQuestionIndex === mcCount) { instructionArea.innerHTML = `<h3 class="font-bold">Ph·∫ßn 2: Tr·∫Øc nghi·ªám ƒë√∫ng sai</h3><p class="text-sm">T·ª´ c√¢u ${mcCount + 1} ƒë·∫øn c√¢u ${totalQuestions}, m·ªói c√¢u c√≥ 4 ph∆∞∆°ng √°n, h·ªçc sinh ch·ªçn ƒê√∫ng ho·∫∑c Sai cho t·ª´ng ph∆∞∆°ng √°n.</p>`; instructionArea.style.display = 'block'; }
        if (isMC) { displayMCQuestion(questionData); } else { displayTFQuestion(questionData); }
        nextButton.textContent = currentQuestionIndex === totalQuestions - 1 ? 'N·ªôp b√†i v√† xem k·∫øt qu·∫£' : 'Ti·∫øp theo';
    }

    function displayMCQuestion(q) {
        const optionsToShuffle = q.options.map((opt, i) => ({ text: opt, originalIndex: i }));
        q.shuffledOrder = shuffleArray(optionsToShuffle).map(opt => opt.originalIndex);
        const optionLabels = ['A.', 'B.', 'C.', 'D.'];
        q.shuffledOrder.forEach((originalIndex, displayIndex) => {
            const card = document.createElement('div');
            card.className = 'option-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-100';
            card.innerHTML = `<span class="font-bold mr-2 text-[#5C6BC0]">${optionLabels[displayIndex]}</span> ${q.options[originalIndex]}`;
            card.addEventListener('click', () => { document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected')); card.classList.add('selected'); userAnswers[currentQuestionIndex] = originalIndex; nextButton.disabled = false; });
            optionsContainer.appendChild(card);
        });
    }

    function displayTFQuestion(q) {
        const optionLabels = ['a)', 'b)', 'c)', 'd)'];
        userAnswers[currentQuestionIndex] = new Array(q.options.length).fill(null);
        q.options.forEach((opt, i) => {
            const item = document.createElement('div');
            item.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200';
            item.innerHTML = `<p><span class="font-bold mr-2 text-[#5C6BC0]">${optionLabels[i]}</span> ${opt.text}</p><div class="flex space-x-2 flex-shrink-0"><button data-choice="ƒê" class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-md bg-green-100 text-green-800 hover:bg-green-200 transition">ƒê√∫ng</button><button data-choice="S" class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-md bg-red-100 text-red-800 hover:bg-red-200 transition">Sai</button></div>`;
            const buttons = item.querySelectorAll('.tf-btn');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    buttons.forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    userAnswers[currentQuestionIndex][i] = button.dataset.choice;
                    if (userAnswers[currentQuestionIndex].every(ans => ans !== null)) { nextButton.disabled = false; }
                });
            });
            optionsContainer.appendChild(item);
        });
    }

    const handleNextButtonClick = () => { currentQuestionIndex < shuffledQuestions.length - 1 ? (currentQuestionIndex++, displayQuestion()) : submitQuiz(); };

    // --- M√ÄN H√åNH K·∫æT QU·∫¢ ---
    function submitQuiz() {
        clearInterval(timerInterval);
        const totalTime = 5 * 60; const timeTaken = totalTime - timeRemaining;
        const minutes = Math.floor(timeTaken / 60).toString().padStart(2, '0');
        const seconds = (timeTaken % 60).toString().padStart(2, '0');
        const timeString = `${minutes}:${seconds}`;

        let score = 0;
        const totalMC = quizData.mc.length, totalTF = quizData.tf.length;
        const maxScore = (totalMC * 0.25) + (totalTF * 1);
        let incorrectTopics = {};
        let correctTopics = {};

        shuffledQuestions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            let isCorrect = false;
            if (q.hasOwnProperty('shuffledOrder')) { // MC question
                if (userAnswer === q.answer) { score += 0.25; isCorrect = true; }
            } else { // TF question
                let correctInTf = 0;
                if(userAnswer) {
                    userAnswer.forEach((ans, optIndex) => { if (ans === q.options[optIndex].answer) correctInTf++; });
                }
                if (correctInTf === 4) { score += 1; isCorrect = true; }
                else if (correctInTf === 3) score += 0.5;
                else if (correctInTf === 2) score += 0.25;
                else if (correctInTf === 1) score += 0.1;
            }
            if(isCorrect) {
                correctTopics[q.topic] = (correctTopics[q.topic] || 0) + 1;
            } else {
                incorrectTopics[q.topic] = (incorrectTopics[q.topic] || 0) + 1;
            }
        });
        score = Math.round(score * 100) / 100;

        resultGreeting.textContent = `ƒê√¢y l√† k·∫øt qu·∫£ b√†i l√†m c·ªßa b·∫°n, ${currentUser.name}.`;
        finalScore.textContent = `${score}/${maxScore}`;
        timeTakenEl.textContent = `Th·ªùi gian l√†m b√†i: ${timeString}`;

        generateFeedback(correctTopics, incorrectTopics);
        generateReview();
        const studentId = `${currentUser.class}-${currentUser.name}`;
        if (!completedStudents.includes(studentId)) {
            completedStudents.push(studentId);
            localStorage.setItem('completedStudents_tin10_hk1', JSON.stringify(completedStudents));
        }
        switchScreen('result-screen');
    }
    
    function generateFeedback(correctTopics, incorrectTopics) {
        let feedbackHTML = '<div>';
        
        feedbackHTML += '<h4 class="font-bold text-lg text-green-700">‚úÖ ∆Øu ƒëi·ªÉm</h4>';
        if (Object.keys(incorrectTopics).length === 0) {
            feedbackHTML += '<p>‚ú® Xu·∫•t s·∫Øc! Em ƒë√£ tr·∫£ l·ªùi ƒë√∫ng t·∫•t c·∫£ c√°c c√¢u h·ªèi. Em ƒë√£ n·∫Øm r·∫•t v·ªØng ki·∫øn th·ª©c v√† c√≥ k·ªπ nƒÉng l√†m b√†i tuy·ªát v·ªùi.</p>';
        } else {
            let strengths = Object.keys(correctTopics).filter(topic => !incorrectTopics[topic]);
            if (strengths.length > 0) {
                feedbackHTML += `<p>Em ƒë√£ l√†m r·∫•t t·ªët v√† n·∫Øm v·ªØng ki·∫øn th·ª©c ·ªü c√°c ch·ªß ƒë·ªÅ: <b>${strengths.join(', ')}</b>.</p>`;
            } else {
                feedbackHTML += '<p>Em ƒë√£ c√≥ s·ª± c·ªë g·∫Øng trong b√†i l√†m. H√£y xem c√°c ph√¢n t√≠ch d∆∞·ªõi ƒë√¢y ƒë·ªÉ c·∫£i thi·ªán h∆°n nh√©.</p>';
            }
        }
        feedbackHTML += '</div>';

        if (Object.keys(incorrectTopics).length > 0) {
            feedbackHTML += '<div class="mt-4">';
            feedbackHTML += '<h4 class="font-bold text-lg text-red-700">‚ùå Nh∆∞·ª£c ƒëi·ªÉm</h4>';
            feedbackHTML += '<p>Em c·∫ßn xem l·∫°i v√† c·ªßng c·ªë th√™m ki·∫øn th·ª©c ·ªü c√°c ch·ªß ƒë·ªÅ sau:</p><ul class="list-disc list-inside mt-2">';
            for (const topic in incorrectTopics) {
                feedbackHTML += `<li><b>${topic}:</b> c√≤n sai ${incorrectTopics[topic]} c√¢u.</li>`;
            }
            feedbackHTML += '</ul></div>';
        }

        if (Object.keys(incorrectTopics).length > 0) {
            feedbackHTML += '<div class="mt-4">';
            feedbackHTML += '<h4 class="font-bold text-lg text-blue-700">üí° L·ªô tr√¨nh h·ªçc t·∫≠p ƒë·ªÅ xu·∫•t</h4>';
            feedbackHTML += '<p>ƒê·ªÉ c·∫£i thi·ªán ƒëi·ªÉm s·ªë, em h√£y t·∫≠p trung v√†o c√°c ph·∫ßn ki·∫øn th·ª©c c√≤n y·∫øu:</p><ul class="list-disc list-inside mt-2 space-y-3">';
            for (const topic in incorrectTopics) {
                const resource = resourceMap[topic];
                if (resource) {
                    feedbackHTML += `<li><b>V·ªõi ch·ªß ƒë·ªÅ "${topic}":</b>
                        <ul class="list-inside ml-4 text-sm space-y-1 mt-1">
                            <li>- <b>L·ªùi khuy√™n:</b> ${resource.advice}</li>
                            <li>- <b>T√†i li·ªáu tham kh·∫£o:</b> ${resource.links.map(l => `<a href="${l.url}" target="_blank" class="text-indigo-600 hover:underline">${l.title}</a>`).join('; ')}</li>
                        </ul>
                    </li>`;
                }
            }
            feedbackHTML += '</ul></div>';
        }
        
        feedbackContent.innerHTML = feedbackHTML;
    }

    function generateReview() {
        reviewContainer.innerHTML = '';
        shuffledQuestions.forEach((q, index) => {
            const isMC = q.hasOwnProperty('shuffledOrder');
            const reviewBlock = document.createElement('div');
            reviewBlock.className = 'p-4 border border-gray-200 rounded-lg';
            let optionsHTML = `<p class="text-md font-semibold mb-3"><b class="text-[#3F51B5]">C√¢u ${index + 1} (${q.topic}):</b> ${q.question.replace(/\n/g, '<br>')}</p><div class="space-y-2">`;
            
            if (isMC) {
                const optionLabels = ['A.', 'B.', 'C.', 'D.'];
                q.shuffledOrder.forEach((originalIndex, displayIndex) => {
                    const userChoice = userAnswers[index];
                    const isCorrect = originalIndex === q.answer;
                    const isSelected = originalIndex === userChoice;
                    let classes = 'review-option p-3 border border-gray-200 rounded-md';
                    if (isSelected && isCorrect) classes += ' correct';
                    else if (isSelected && !isCorrect) classes += ' incorrect';
                    else if (isCorrect) classes += ' missed-correct';
                    optionsHTML += `<div class="${classes}"><span class="font-bold mr-2 text-[#5C6BC0]">${optionLabels[displayIndex]}</span> ${q.options[originalIndex]}</div>`;
                });
            } else { // TF
                const optionLabels = ['a)', 'b)', 'c)', 'd)'];
                q.options.forEach((opt, optIndex) => {
                    const userChoice = userAnswers[index] ? userAnswers[index][optIndex] : null;
                    const isCorrect = userChoice === opt.answer;
                    let trueBtnClass = 'tf-btn px-3 py-1 text-sm rounded';
                    let falseBtnClass = 'tf-btn px-3 py-1 text-sm rounded';

                    if(userChoice === 'ƒê') {
                        trueBtnClass += isCorrect ? ' review-tf-btn correct' : ' review-tf-btn incorrect';
                    } else if (userChoice === 'S') {
                        falseBtnClass += isCorrect ? ' review-tf-btn correct' : ' review-tf-btn incorrect';
                    }

                    optionsHTML += `<div class="flex items-center justify-between p-2 bg-gray-50 rounded-md">
                        <p><span class="font-bold mr-2 text-[#5C6BC0]">${optionLabels[optIndex]}</span> ${opt.text}</p>
                        <div class="flex space-x-2">
                            <span class="${trueBtnClass}">ƒê√∫ng</span>
                            <span class="${falseBtnClass}">Sai</span>
                        </div>
                    </div>`;
                });
            }
            optionsHTML += `</div>`;
            reviewBlock.innerHTML = optionsHTML;
            reviewContainer.appendChild(reviewBlock);
        });
    }
    
    function handleCopy() {
        const scoreText = finalScore.textContent;
        const timeText = timeTakenEl.textContent.split(': ')[1] || 'N/A';
        const textToCopy = `${currentUser.name} ${currentUser.class} ${timeText} ${scoreText}`;
        
        const textArea = document.createElement('textarea');
        textArea.value = textToCopy;
        textArea.style.position = 'fixed';
        textArea.style.top = '-9999px';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful) {
                copyFeedback.style.opacity = '1';
                setTimeout(() => { copyFeedback.style.opacity = '0'; }, 2000);
            }
        } catch (err) {
            console.error('Kh√¥ng th·ªÉ sao ch√©p', err);
        }

        document.body.removeChild(textArea);
    }
    
    // --- KH·ªûI T·∫†O & S·ª∞ KI·ªÜN ---
    document.addEventListener('DOMContentLoaded', () => {
        initLoginScreen();
        classSelectBtn.addEventListener('click', () => toggleDropdown(classSelectOptions));
        studentSelectBtn.addEventListener('click', () => toggleDropdown(studentSelectOptions));
        
        window.addEventListener('click', function(e) {
            if (!classSelectBtn.contains(e.target) && !classSelectOptions.contains(e.target)) {
                classSelectOptions.classList.add('opacity-0', 'scale-95');
                setTimeout(() => classSelectOptions.classList.add('hidden'), 200);
            }
            if (!studentSelectBtn.contains(e.target) && !studentSelectOptions.contains(e.target)) {
                studentSelectOptions.classList.add('opacity-0', 'scale-95');
                setTimeout(() => studentSelectOptions.classList.add('hidden'), 200);
            }
        });

        startButton.addEventListener('click', startQuiz);
        nextButton.addEventListener('click', handleNextButtonClick);
        copyButton.addEventListener('click', handleCopy);
        endButton.addEventListener('click', initLoginScreen);
    });
    </script>
</body>
</html>
