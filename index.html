<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Vui Nh·ªôn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Quicksand', sans-serif;
            background-color: #EFF6FF; /* blue-50 */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2360A5FA' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .quiz-option {
            -webkit-appearance: none;
            appearance: none;
        }
        .quiz-option.selected { 
            background-color: #3B82F6; /* blue-500 */
            color: white; 
            border-color: #2563EB; /* blue-600 */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .review-option.correct {
            background-color: #DCFCE7; /* green-100 */
            border-color: #22C55E; /* green-500 */
            color: #15803D; /* green-800 */
        }
        .review-option.incorrect {
            background-color: #FEE2E2; /* red-100 */
            border-color: #EF4444; /* red-500 */
            color: #B91C1C; /* red-800 */
        }
        .tf-btn.selected { 
            transform: scale(1.1); 
            box-shadow: 0 0 0 3px #3B82F6; /* blue-500 */
        }
        button:disabled { 
            background-color: #d1d5db; /* gray-400 */
            cursor: not-allowed; 
        }
        .main-container {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="main-container w-full max-w-2xl mx-auto rounded-3xl shadow-2xl shadow-blue-200 p-6 md:p-8 transition-all duration-500">
        <!-- Start Screen -->
        <div id="start-screen">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-blue-800">KI·ªÇM TRA H·ªåC K√å I NƒÇM H·ªåC 2025 - 2026</h1>
                <h2 class="text-xl font-semibold text-blue-700 mt-1">M√îN: TIN H·ªåC - L·ªöP: 10</h2>
                <p class="text-base text-blue-600 mt-2">Th·ªùi gian l√†m b√†i: 5 ph√∫t</p>
            </div>
            <p class="text-center text-gray-600 mb-6 border-t border-blue-200 pt-6">Vui l√≤ng ch·ªçn ƒë√∫ng th√¥ng tin c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
            <div class="space-y-4">
                <div>
                    <label for="class-select" class="block text-sm font-bold text-gray-700 mb-2">1. Ch·ªçn L·ªõp:</label>
                    <select id="class-select" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">-- Vui l√≤ng ch·ªçn l·ªõp --</option>
                    </select>
                </div>
                <div>
                    <label for="name-select" class="block text-sm font-bold text-gray-700 mb-2">2. Ch·ªçn T√™n c·ªßa b·∫°n:</label>
                    <select id="name-select" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-blue-500 focus:border-blue-500 transition" disabled>
                        <option value="">-- Ch·ªù ch·ªçn l·ªõp --</option>
                    </select>
                </div>
            </div>
            <button id="start-btn" class="mt-8 w-full bg-blue-500 text-white font-bold py-4 px-4 rounded-xl hover:bg-blue-600 transition-all duration-300 transform hover:scale-105 shadow-lg" disabled>B·∫Øt ƒë·∫ßu l√†m b√†i</button>
            <p id="info-error" class="text-red-500 text-sm mt-2 text-center hidden">Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß th√¥ng tin.</p>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
             <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">C√¢u <span id="question-number"></span>/<span id="total-questions"></span></h2>
                <div class="flex items-center space-x-2 bg-red-100 text-red-700 font-semibold px-4 py-2 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span id="timer">05:00</span>
                </div>
            </div>
            
            <div id="instruction-block" class="hidden mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                <h3 id="part-name" class="text-lg font-bold text-blue-800"></h3>
                <p id="part-instruction" class="text-sm text-blue-700 mt-1"></p>
            </div>

            <div id="question-container" class="mb-6">
                <p id="question-text" class="text-lg font-semibold text-gray-900 mb-5 whitespace-pre-wrap"></p>
                <div id="options-container" class="space-y-4"></div>
            </div>
            <button id="submit-btn" class="w-full bg-blue-500 text-white font-bold py-4 px-4 rounded-xl hover:bg-blue-600 transition-all duration-300 transform hover:scale-105 shadow-lg" disabled>Ti·∫øp theo</button>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden">
             <div id="result-content">
                <h1 class="text-4xl font-bold text-center text-green-600 mb-2">Ho√†n th√†nh!</h1>
                <p class="text-center text-gray-600 mb-4">ƒê√¢y l√† k·∫øt qu·∫£ b√†i l√†m c·ªßa b·∫°n, <strong id="result-student-name" class="text-blue-600"></strong>.</p>
                <div class="bg-blue-50 rounded-2xl p-6 mb-6 text-center">
                    <p class="text-lg text-blue-800">ƒêi·ªÉm s·ªë c·ªßa b·∫°n:</p>
                    <p class="text-6xl font-extrabold text-blue-900 my-2"><span id="score"></span> / <span id="max-score"></span></p>
                    <p class="text-blue-700">Th·ªùi gian l√†m b√†i: <span id="time-taken" class="font-medium"></span></p>
                </div>
             </div>
             <div class="mt-6 pt-6 border-t border-blue-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">G·ª≠i k·∫øt qu·∫£ cho gi√°o vi√™n</h3>
                <div class="grid grid-cols-1 gap-4">
                    <button id="copy-btn" class="w-full bg-slate-600 text-white font-bold py-3 px-4 rounded-xl hover:bg-slate-700 transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2H6zm1 4a1 1 0 100 2h6a1 1 0 100-2H7zm0 4a1 1 0 100 2h6a1 1 0 100-2H7z" /></svg>
                        <span>Sao ch√©p (Zalo, Messenger)</span>
                    </button>
                </div>
                 <p id="copy-success" class="text-green-600 text-sm mt-3 text-center hidden">ƒê√£ sao ch√©p th√†nh c√¥ng!</p>
             </div>
             <div id="review-section" class="mt-6 pt-6 border-t border-blue-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Xem l·∫°i b√†i l√†m</h3>
                <div id="review-container" class="space-y-4"></div>
            </div>
            <div id="feedback-section" class="mt-6 pt-6 border-t border-blue-200">
                 <h3 class="text-xl font-bold text-gray-800 mb-4">Nh·∫≠n x√©t</h3>
                 <div id="feedback-container" class="text-sm space-y-4"></div>
            </div>
             <div class="mt-8 pt-6 border-t border-blue-200 text-center">
                 <button id="end-quiz-btn" class="bg-indigo-500 text-white font-bold py-3 px-4 rounded-xl hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105 shadow-lg inline-flex items-center justify-center space-x-2">
                    <span>K·∫øt th√∫c</span>
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // The JavaScript logic remains the same as the previous correct version.
        // All functionality is preserved.
        const studentList = {
            "10A1": [
                { stt: 1, name: "Nguy·ªÖn VƒÉn An" },
                { stt: 2, name: "Ph·∫°m Minh C∆∞·ªùng" },
                { stt: 3, name: "B√πi Th·ªã H·ªìng Thu" },
                { stt: 4, name: "Nguy·ªÖn T√¥ S∆°n" }
            ],
            "10A2": [
                { stt: 1, name: "Ho√†ng VƒÉn Giang" },
                { stt: 2, name: "V≈© Th·ªã H∆∞∆°ng" },
                { stt: 3, name: "ƒê·ªó VƒÉn √çch" },
                { stt: 4, name: "B√πi Th·ªã Kim" },
                { stt: 5, name: "Tr·∫ßn VƒÉn Long" }
            ],
            "10A3": [
                { stt: 1, name: "L√Ω Th·ªã Mai" },
                { stt: 2, name: "Ng√¥ Gia Nam" },
                { stt: 3, name: "D∆∞∆°ng Th·ªã Oanh" },
                { stt: 4, name: "Phan VƒÉn Ph√∫c" },
                { stt: 5, name: "H√† Th·ªã Qu·ª≥nh" }
            ],
            "10A4": [
                { stt: 1, name: "H·ªçc sinh A4-1" },
                { stt: 2, name: "H·ªçc sinh A4-2" }
            ],
            "10A5": [
                { stt: 1, name: "H·ªçc sinh A5-1" },
                { stt: 2, name: "H·ªçc sinh A5-2" }
            ],
            "10A6": [
                { stt: 1, name: "H·ªçc sinh A6-1" },
                { stt: 2, name: "H·ªçc sinh A6-2" }
            ],
            "10A7": [
                { stt: 1, name: "H·ªçc sinh A7-1" },
                { stt: 2, name: "H·ªçc sinh A7-2" }
            ]
        };

        const fullQuizData = [
            {
                part: "I. PH·∫¶N TR·∫ÆC NGHI·ªÜM NHI·ªÄU PH∆Ø∆†NG √ÅN L·ª∞A CH·ªåN",
                instruction: "T·ª´ c√¢u 1 ƒë·∫øn c√¢u 12, m·ªói c√¢u h·ªèi h·ªçc sinh ch·ªâ ch·ªçn m·ªôt ph∆∞∆°ng √°n.",
                questions: [
                    { type: "multiple-choice", topic: "L·ªánh l·∫∑p", question: "Ph∆∞∆°ng √°n n√†o d∆∞·ªõi ƒë√¢y m√¥ t·∫£ s·ª± kh√°c bi·ªát gi·ªØa c√¢u l·ªánh l·∫∑p for v√† while trong Python?", options: ["C√¢u l·ªánh for ƒë∆∞·ª£c s·ª≠ d·ª•ng khi s·ªë l·∫ßn l·∫∑p kh√¥ng x√°c ƒë·ªãnh, c√≤n while ƒë∆∞·ª£c s·ª≠ d·ª•ng khi s·ªë l·∫ßn l·∫∑p ƒë√£ bi·∫øt.", "C√¢u l·ªánh for ƒë∆∞·ª£c s·ª≠ d·ª•ng khi bi·∫øt s·ªë l·∫ßn l·∫∑p v√† c√≥ th·ªÉ l·∫∑p qua m·ªôt d√£y gi√° tr·ªã, trong khi while kh√¥ng bi·∫øt tr∆∞·ªõc s·ªë l·∫ßn l·∫∑p, l·∫∑p khi ƒëi·ªÅu ki·ªán ti·∫øp t·ª•c ƒë∆∞·ª£c th·ªèa m√£n.", "C·∫£ for v√† while ƒë·ªÅu d√πng ƒë·ªÉ l·∫∑p qua m·ªôt d√¢y gi√° tr·ªã x√°c ƒë·ªãnh.", "C√¢u l·ªánh for kh√¥ng th·ªÉ l·∫∑p v√¥ h·∫°n, trong khi while c√≥ th·ªÉ."], answer: "C√¢u l·ªánh for ƒë∆∞·ª£c s·ª≠ d·ª•ng khi bi·∫øt s·ªë l·∫ßn l·∫∑p v√† c√≥ th·ªÉ l·∫∑p qua m·ªôt d√£y gi√° tr·ªã, trong khi while kh√¥ng bi·∫øt tr∆∞·ªõc s·ªë l·∫ßn l·∫∑p, l·∫∑p khi ƒëi·ªÅu ki·ªán ti·∫øp t·ª•c ƒë∆∞·ª£c th·ªèa m√£n." },
                    { type: "multiple-choice", topic: "H√†m", question: "Khi g·ªçi m·ªôt h√†m c√≥ tham s·ªë nh∆∞ng kh√¥ng g√°n gi√° tr·ªã m·∫∑c ƒë·ªãnh cho tham s·ªë th√¨ ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra d∆∞·ªõi ƒë√¢y n·∫øu kh√¥ng truy·ªÅn ƒë·ªß s·ªë l∆∞·ª£ng ƒë·ªëi s·ªë cho tham s·ªë trong l·ªùi g·ªçi h√†m?", options: ["Python s·∫Ω t·ª± ƒë·ªông g√°n gi√° tr·ªã None cho c√°c tham s·ªë thi·∫øu.", "Ch∆∞∆°ng tr√¨nh s·∫Ω b√°o l·ªói TypeError.", "Ch∆∞∆°ng tr√¨nh b·ªè qua tham s·ªë thi·∫øu v√† ti·∫øp t·ª•c ch·∫°y.", "Python s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn gi√° tr·ªã m·∫∑c ƒë·ªãnh 0."], answer: "Ch∆∞∆°ng tr√¨nh s·∫Ω b√°o l·ªói TypeError." },
                    { type: "multiple-choice", topic: "H√†m", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y ƒë√∫ng khi n√≥i v·ªÅ h√†m abs() trong Python?", options: ["H√†m abs() tr·∫£ v·ªÅ ph·∫ßn th·ª±c c·ªßa m·ªôt s·ªë ph·ª©c.", "H√†m abs() tr·∫£ v·ªÅ gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa m·ªôt s·ªë.", "H√†m abs() tr·∫£ v·ªÅ gi√° tr·ªã √¢m c·ªßa m·ªôt s·ªë.", "H√†m abs() tr·∫£ v·ªÅ ph·∫ßn nguy√™n c·ªßa m·ªôt s·ªë th·ª±c."], answer: "H√†m abs() tr·∫£ v·ªÅ gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa m·ªôt s·ªë." },
                    { type: "multiple-choice", topic: "X√¢u k√Ω t·ª±", question: "Khi s·ª≠ d·ª•ng h√†m len(s) v·ªõi m·ªôt x√¢u k√≠ t·ª± s, k·∫øt qu·∫£ tr·∫£ v·ªÅ l√† g√¨?", options: ["S·ªë k√≠ t·ª± trong x√¢u, bao g·ªìm c·∫£ d·∫•u c√°ch", "S·ªë l∆∞·ª£ng t·ª´ c√≥ trong x√¢u", "Ch·ªâ t√≠nh c√°c k√≠ t·ª± ch·ªØ c√°i trong x√¢u", "ƒê·ªô d√†i t·ªëi ƒëa m√† x√¢u c√≥ th·ªÉ ch·ª©a"], answer: "S·ªë k√≠ t·ª± trong x√¢u, bao g·ªìm c·∫£ d·∫•u c√°ch" },
                    { type: "multiple-choice", topic: "X√¢u k√Ω t·ª±", question: "Cho ƒëo·∫°n l·ªánh Python sau:\ny = \"abcdef\"\nprint(y[:4])\nK·∫øt qu·∫£ n√†o sau ƒë√¢y l√† ƒë√∫ng khi th·ª±c hi·ªán ƒëo·∫°n l·ªánh tr√™n?", options: ["abcd", "bcde", "abc", "abcdef"], answer: "abcd" },
                    { type: "multiple-choice", topic: "Danh s√°ch", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y m√¥ t·∫£ ƒë√∫ng c√°ch truy c·∫≠p ph·∫ßn t·ª≠ trong danh s√°ch A t·∫°i v·ªã tr√≠ ch·ªâ s·ªë 2?", options: ["A<2>", "A(2)", "A{2}", "A[2]"], answer: "A[2]" },
                    { type: "multiple-choice", topic: "Danh s√°ch", question: "Cho danh s√°ch sau: A = [\"apple\", \"banana\", \"cherry\", \"date\", \"elderberry\", \"fig\", \"grape\"]. Ph∆∞∆°ng √°n n√†o sau ƒë√¢y n√™u ƒë√∫ng gi√° tr·ªã c·ªßa ph·∫ßn t·ª≠ A[5]?", options: ["\"elderberry\"", "\"grape\"", "\"fig\"", "\"date\""], answer: "\"fig\"" },
                    { type: "multiple-choice", topic: "L·ªói ch∆∞∆°ng tr√¨nh", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y ƒëi·ªÅn t·ª´ ƒë√∫ng v√†o ch·ªó tr·ªëng: \"... l√† m·ªôt l·ªói khi ch∆∞∆°ng tr√¨nh kh√¥ng tu√¢n theo c√°c quy ƒë·ªãnh ng·ªØ ph√°p c·ªßa ng√¥n ng·ªØ l·∫≠p tr√¨nh\"?", options: ["L·ªói ng·ªØ nghƒ©a.", "L·ªói c√∫ ph√°p.", "L·ªói logic.", "L·ªói ngo·∫°i l·ªá."], answer: "L·ªói c√∫ ph√°p." },
                    { type: "multiple-choice", topic: "L·∫≠p tr√¨nh", question: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y gi·∫£i th√≠ch t·∫°i sao vi·ªác ki·ªÉm th·ª≠ ch∆∞∆°ng tr√¨nh l·∫°i quan tr·ªçng trong qu√° tr√¨nh l·∫≠p tr√¨nh?", options: ["Ki·ªÉm th·ª≠ gi√∫p ƒë·∫£m b·∫£o r·∫±ng ch∆∞∆°ng tr√¨nh ƒë√£ ho√†n ch·ªânh v√† c√≥ th·ªÉ ch·∫°y ngay l·∫≠p t·ª©c m√† kh√¥ng c·∫ßn thay ƒë·ªïi g√¨.", "Ki·ªÉm th·ª≠ gi√∫p x√°c ƒë·ªãnh l·ªói v√† ƒëi·ªÅu ch·ªânh ch∆∞∆°ng tr√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o k·∫øt qu·∫£ ƒë√∫ng v·ªõi y√™u c·∫ßu b√†i to√°n.", "Ki·ªÉm th·ª≠ kh√¥ng c·∫ßn thi·∫øt n·∫øu ch∆∞∆°ng tr√¨nh ch·∫°y ƒë√∫ng ·ªü l·∫ßn ƒë·∫ßu ti√™n.", "Ki·ªÉm th·ª≠ ch·ªâ c·∫ßn thi·∫øt khi ch∆∞∆°ng tr√¨nh ƒë√£ ho√†n th√†nh 100%."], answer: "Ki·ªÉm th·ª≠ gi√∫p x√°c ƒë·ªãnh l·ªói v√† ƒëi·ªÅu ch·ªânh ch∆∞∆°ng tr√¨nh ƒë·ªÉ ƒë·∫£m b·∫£o k·∫øt qu·∫£ ƒë√∫ng v·ªõi y√™u c·∫ßu b√†i to√°n." },
                    { type: "multiple-choice", topic: "L·∫≠p tr√¨nh", question: "T·∫°i sao vi·ªác x√°c ƒë·ªãnh c√°ch t·ªï ch·ª©c d·ªØ li·ªáu l√† m·ªôt ph·∫ßn quan tr·ªçng trong b∆∞·ªõc t√¨m thu·∫≠t to√°n?", options: ["ƒê·ªÉ l√†m cho ch∆∞∆°ng tr√¨nh nhanh h∆°n m√† kh√¥ng c·∫ßn t√≠nh to√°n.", "ƒê·ªÉ ch·ªçn ƒë∆∞·ª£c ng√¥n ng·ªØ l·∫≠p tr√¨nh th√≠ch h·ª£p cho b√†i to√°n.", "ƒê·ªÉ ƒë·∫£m b·∫£o r·∫±ng thu·∫≠t to√°n c√≥ th·ªÉ ho·∫°t ƒë·ªông tr√™n c√°c c·∫•u tr√∫c d·ªØ li·ªáu ph√π h·ª£p.", "ƒê·ªÉ gi·∫£i quy·∫øt b√†i to√°n m√† kh√¥ng c·∫ßn ki·ªÉm th·ª≠ ch∆∞∆°ng tr√¨nh."], answer: "ƒê·ªÉ ƒë·∫£m b·∫£o r·∫±ng thu·∫≠t to√°n c√≥ th·ªÉ ho·∫°t ƒë·ªông tr√™n c√°c c·∫•u tr√∫c d·ªØ li·ªáu ph√π h·ª£p." },
                    { type: "multiple-choice", topic: "GIMP", question: "Ph∆∞∆°ng √°n n√†o sau ƒë√¢y l√† vai tr√≤ c·ªßa ph·∫ßn m·ªÅm GIMP trong vi·ªác thi·∫øt k·∫ø ƒë·ªì h·ªça?", options: ["Qu·∫£n l√Ω c√°c t·ªáp ·∫£nh v√† l∆∞u tr·ªØ ch√∫ng", "Cung c·∫•p c√°c c√¥ng c·ª• thi·∫øt k·∫ø ƒë·ªì h·ªça nh∆∞ t·∫°o vƒÉn b·∫£n, t√¥ m√†u, gh√©p ·∫£nh", "T·∫°o ra c√°c ph·∫ßn m·ªÅm di ƒë·ªông", "H·ªó tr·ª£ ch·ªânh s·ª≠a video"], answer: "Cung c·∫•p c√°c c√¥ng c·ª• thi·∫øt k·∫ø ƒë·ªì h·ªça nh∆∞ t·∫°o vƒÉn b·∫£n, t√¥ m√†u, gh√©p ·∫£nh" },
                    { type: "multiple-choice", topic: "GIMP", question: "Trong GIMP, n·∫øu m·ªôt ƒëi·ªÉm ·∫£nh c√≥ gi√° tr·ªã k√™nh alpha l√† 0 th√¨ ƒëi·ªÅu n√†y c√≥ nghƒ©a g√¨ sau ƒë√¢y?", options: ["ƒêi·ªÉm ·∫£nh ƒë√≥ c√≥ m√†u ƒëen.", "ƒêi·ªÉm ·∫£nh ƒë√≥ c√≥ m√†u tr·∫Øng.", "ƒêi·ªÉm ·∫£nh ƒë√≥ kh√¥ng hi·ªÉn th·ªã.", "ƒêi·ªÉm ·∫£nh ƒë√≥ hi·ªÉn th·ªã m·ªù."], answer: "ƒêi·ªÉm ·∫£nh ƒë√≥ kh√¥ng hi·ªÉn th·ªã." }
                ]
            },
            {
                part: "II. PH·∫¶N TR·∫ÆC NGHI·ªÜM ƒê√öNG SAI",
                instruction: "T·ª´ c√¢u 13 ƒë·∫øn c√¢u 16, m·ªói c√¢u h·ªèi c√≥ 4 ph∆∞∆°ng √°n, h·ªçc sinh ch·ªçn ƒë√∫ng ho·∫∑c sai cho t·ª´ng ph∆∞∆°ng √°n.",
                questions: [
                    { type: "true-false", topic: "Th∆∞ vi·ªán Python", question: "Trong m·ªôt gi·ªù h·ªçc l·∫≠p tr√¨nh Python, th·∫ßy gi√°o gi·ªõi thi·ªáu cho c√°c b·∫°n h·ªçc sinh l·ªõp 10A v·ªÅ th∆∞ vi·ªán h√†m c√≥ s·∫µn. Mu·ªën s·ª≠ d·ª•ng c√°c h√†m n√†y ch·ªâ c·∫ßn k·∫øt n·ªëi h√†m ho·∫∑c th∆∞ vi·ªán ch·ª©a h√†m v·ªõi ch∆∞∆°ng tr√¨nh, g·ªçi ƒë·∫øn h√†m v√† truy·ªÅn v√†o gi√° tr·ªã cho c√°c tham s·ªë trong h√†m. C√°c b·∫°n h·ªçc sinh sau khi nghe ph√¢n t√≠ch c·ªßa th·∫ßy ƒë√£ ƒë∆∞a ra m·ªôt s·ªë nh·∫≠n x√©t sau:", options: [{ text: "Trong Python, th∆∞ vi·ªán l√† m·ªôt t·∫≠p h·ª£p g·ªìm m·ªôt s·ªë h√†m ƒë√£ ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn.", answer: true }, { text: "C√°c h√†m c√≥ s·∫µn trong Python ƒë∆∞·ª£c s·ª≠ d·ª•ng lu√¥n trong ch∆∞∆°ng tr√¨nh, kh√¥ng c·∫ßn k·∫øt n·ªëi h√†m hay th∆∞ vi·ªán ch·ª©a h√†m v·ªõi ch∆∞∆°ng tr√¨nh.", answer: false }, { text: "Khi th·ª±c hi·ªán l·ªùi g·ªçi h√†m, b·∫•t k·ªÉ h√†m n√†o c≈©ng c·∫ßn truy·ªÅn v√†o gi√° tr·ªã cho tham s·ªë ƒë·ªÉ h√†m th·ª±c hi·ªán.", answer: false }, { text: "Python h·ªó tr·ª£ nhi·ªÅu h√†m c√≥ s·∫µn gi√∫p cho ng∆∞·ªùi l·∫≠p tr√¨nh vi·∫øt ch∆∞∆°ng tr√¨nh nhanh g·ªçn, kh√¥ng c·∫ßn ph·∫£i x√¢y d·ª±ng c√°c ƒëo·∫°n l·ªánh d√†i v√† ph·ª©c t·∫°p.", answer: true }] },
                    { type: "true-false", topic: "S·∫Øp x·∫øp danh s√°ch", question: "M·ªôt nh√≥m h·ªçc sinh ƒëang th·ª±c hi·ªán b√†i t·∫≠p s·∫Øp x·∫øp danh s√°ch A c√°c ƒëi·ªÉm s·ªë c·ªßa m√¨nh trong Python. Sau khi nh·∫≠p c√°c ƒëi·ªÉm s·ªë v√†o danh s√°ch, nh√≥m h·ªçc sinh mu·ªën s·∫Øp x·∫øp c√°c ƒëi·ªÉm s·ªë theo th·ª© t·ª± tƒÉng d·∫ßn. C√°c b·∫°n h·ªçc sinh ƒë√£ ƒë∆∞a ra c√°c nh·∫≠n x√©t sau:", options: [{ text: "H√†m A.sort() ch·ªâ s·∫Øp x·∫øp danh s√°ch theo th·ª© t·ª± tƒÉng d·∫ßn.", answer: false }, { text: "H√†m A.sort() ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi c√°c danh s√°ch ch·ª©a c√°c ph·∫ßn t·ª≠ c√πng ki·ªÉu d·ªØ li·ªáu.", answer: false }, { text: "Khi th·ª±c hi·ªán s·∫Øp x·∫øp b·∫±ng h√†m A.sort(), danh s√°ch s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi tr·ª±c ti·∫øp v√† kh√¥ng c·∫ßn ph·∫£i g√°n l·∫°i gi√° tr·ªã cho danh s√°ch.", answer: true }, { text: "ƒê·ªÉ s·∫Øp x·∫øp danh s√°ch ƒëi·ªÉm theo th·ª© t·ª± kh√¥ng gi·∫£m, c√≥ th·ªÉ d√πng l·ªánh A.sort().", answer: true }] },
                    { type: "true-false", topic: "Ngh·ªÅ l·∫≠p tr√¨nh", question: "M·ªôt c√¥ng ty c√¥ng ngh·ªá ƒëang t·ªï ch·ª©c h·ªôi th·∫£o v·ªÅ ngh·ªÅ l·∫≠p tr√¨nh ƒë·ªÉ tuy·ªÉn d·ª•ng nh√¢n s·ª± tr·∫ª. Sau khi tham gia h·ªôi th·∫£o, s·ªë ·ª©ng vi√™n ƒë√£ c√≥ nh·ªØng nh·∫≠n x√©t sau:", options: [{ text: "C√¥ng vi·ªác l·∫≠p tr√¨nh ch·ªâ li√™n quan ƒë·∫øn vi·ªác vi·∫øt m√£, kh√¥ng ƒë√≤i h·ªèi s·ª± ki√™n tr√¨ hay kh·∫£ nƒÉng ch·ªãu √°p l·ª±c.", answer: false }, { text: "Vi·ªác l·∫≠p tr√¨nh kh√¥ng ƒë∆°n gi·∫£n ch·ªâ l√† vi·∫øt m√£, m√† c√≤n bao g·ªìm g·ª° l·ªói, t·ªëi ∆∞u h√≥a v√† ki·ªÉm th·ª≠ ph·∫ßn m·ªÅm.", answer: true }, { text: "L·∫≠p tr√¨nh vi√™n th∆∞·ªùng ph·∫£i l√†m vi·ªác v·ªõi nhi·ªÅu d·ª± √°n c√πng l√∫c v√† c√≥ th·ªùi h·∫°n ch·∫∑t ch·∫Ω.", answer: true }, { text: "M·ªôt l·∫≠p tr√¨nh vi√™n gi·ªèi kh√¥ng ch·ªâ c·∫ßn k·ªπ nƒÉng chuy√™n m√¥n m√† c√≤n ph·∫£i c√≥ kh·∫£ nƒÉng giao ti·∫øp ƒë·ªÉ l√†m vi·ªác hi·ªáu qu·∫£ trong nh√≥m.", answer: true }] },
                    { type: "true-false", topic: "GIMP", question: "An ƒë∆∞·ª£c giao nhi·ªám v·ª• thi·∫øt k·∫ø logo cho c√¢u l·∫°c b·ªô Tin h·ªçc c·ªßa tr∆∞·ªùng b·∫±ng ph·∫ßn m·ªÅm GIMP. Logo g·ªìm h√¨nh ·∫£nh m·ªôt ch√∫ chim c√°nh c·ª•t ƒëang ƒë·ª©ng tr√™n qu·∫£ ƒë·ªãa c·∫ßu. An ƒë√£ v·∫Ω h√¨nh ch√∫ chim c√°nh c·ª•t tr√™n m·ªôt l·ªõp v√† h√¨nh qu·∫£ ƒë·ªãa c·∫ßu tr√™n m·ªôt l·ªõp kh√°c. Khi An mu·ªën di chuy·ªÉn h√¨nh ch√∫ chim c√°nh c·ª•t l√™n tr√™n m·ªôt ch√∫t so v·ªõi qu·∫£ ƒë·ªãa c·∫ßu, b·∫°n ·∫•y n√™n th·ª±c hi·ªán thao t√°c n√†o sau ƒë√¢y?", options: [{ text: "C√¥ng c·ª• Move Tool d√πng ƒë·ªÉ di chuy·ªÉn c√°c ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c ch·ªçn.", answer: false }, { text: "H√¨nh ch√∫ chim c√°nh c·ª•t v√† h√¨nh qu·∫£ ƒë·ªãa c·∫ßu n·∫±m tr√™n hai l·ªõp kh√°c nhau, do ƒë√≥ c√≥ th·ªÉ di chuy·ªÉn ƒë·ªôc l·∫≠p.", answer: true }, { text: "C√≥ th·ªÉ di chuy·ªÉn ƒë·ªìng th·ªùi c·∫£ hai h√¨nh ·∫£nh c√πng l√∫c sang v·ªã tr√≠ kh√°c so v·ªõi ban ƒë·∫ßu b·∫±ng c√°ch nh√≥m hai l·ªõp l·∫°i v·ªõi nhau.", answer: false }, { text: "Mu·ªën di chuy·ªÉn h√¨nh ch√∫ chim c√°nh c·ª•t l√™n tr√™n m·ªôt ch√∫t so v·ªõi qu·∫£ ƒë·ªãa c·∫ßu, An kh√¥ng c·∫ßn di chuy·ªÉn l·ªõp, ch·ªâ c·∫ßn di chuy·ªÉn h√¨nh v·∫Ω ch√∫ chim c√°nh c·ª•t tr√™n l·ªõp ·∫£nh t∆∞∆°ng ·ª©ng.", answer: false }] }
                ]
            }
        ];
        const QUIZ_TIME_SECONDS = 300; // 5 ph√∫t

        // DOM Elements
        const startScreen = document.getElementById('start-screen'), quizScreen = document.getElementById('quiz-screen'), resultScreen = document.getElementById('result-screen');
        const classSelect = document.getElementById('class-select'), nameSelect = document.getElementById('name-select');
        const startBtn = document.getElementById('start-btn'), infoError = document.getElementById('info-error');
        const questionNumberEl = document.getElementById('question-number'), totalQuestionsEl = document.getElementById('total-questions'), timerEl = document.getElementById('timer');
        const instructionBlock = document.getElementById('instruction-block'), partNameEl = document.getElementById('part-name'), partInstructionEl = document.getElementById('part-instruction');
        const questionTextEl = document.getElementById('question-text'), optionsContainer = document.getElementById('options-container');
        const submitBtn = document.getElementById('submit-btn');
        const resultStudentNameEl = document.getElementById('result-student-name'), scoreEl = document.getElementById('score'), maxScoreEl = document.getElementById('max-score'), timeTakenEl = document.getElementById('time-taken');
        const reviewContainer = document.getElementById('review-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const copyBtn = document.getElementById('copy-btn'), copySuccess = document.getElementById('copy-success');
        const endQuizBtn = document.getElementById('end-quiz-btn');

        // State
        let currentQuestionIndex = 0, score = 0, timeRemaining = QUIZ_TIME_SECONDS;
        let userAnswers = [], timerInterval;
        let selectedStudent = {}; 
        let flattenedShuffledQuiz = [];
        let completedStudents = []; // NEW: Array to track completed students

        // --- Login Screen Logic ---
        function populateClassSelect() {
            const classNames = Object.keys(studentList);
            classSelect.innerHTML = '<option value="">-- Vui l√≤ng ch·ªçn l·ªõp --</option>'; // Clear previous options
            classNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                classSelect.appendChild(option);
            });
        }

        function handleClassChange() {
            const selectedClass = classSelect.value;
            nameSelect.innerHTML = '<option value="">-- Ch·ªçn t√™n c·ªßa b·∫°n --</option>'; 
            startBtn.disabled = true;

            if (selectedClass) {
                nameSelect.disabled = false;
                const students = studentList[selectedClass];
                students.forEach(student => {
                    // NEW: Check if student has already completed the quiz
                    const hasCompleted = completedStudents.some(s => s.stt === student.stt && s.className === selectedClass);
                    if (!hasCompleted) {
                        const option = document.createElement('option');
                        option.value = student.stt;
                        option.textContent = `${student.stt}. ${student.name}`;
                        nameSelect.appendChild(option);
                    }
                });
            } else {
                nameSelect.disabled = true;
            }
        }

        function handleNameChange() {
            if (classSelect.value && nameSelect.value) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        // --- Main Functions ---
        function startQuiz() {
            const className = classSelect.value;
            const studentStt = parseInt(nameSelect.value);

            if (!className || !studentStt) {
                infoError.classList.remove("hidden");
                return;
            }
            infoError.classList.add("hidden");
            
            selectedStudent = studentList[className].find(s => s.stt === studentStt);

            startScreen.classList.add("hidden");
            quizScreen.classList.remove("hidden");
            resultScreen.classList.add("hidden");
            
            const quizCopy = JSON.parse(JSON.stringify(fullQuizData));
            flattenedShuffledQuiz = [];
            quizCopy.forEach(part => {
                shuffleArray(part.questions); 
                part.questions.forEach(q => {
                    shuffleArray(q.options); 
                    q.partName = part.part;
                    q.partInstruction = part.instruction;
                });
                flattenedShuffledQuiz.push(...part.questions);
            });

            currentQuestionIndex = 0;
            score = 0;
            timeRemaining = QUIZ_TIME_SECONDS;
            userAnswers = flattenedShuffledQuiz.map(q => q.type === 'multiple-choice' ? null : new Array(q.options.length).fill(null));
            totalQuestionsEl.textContent = flattenedShuffledQuiz.length;
            
            showQuestion();
            startTimer();
        }
        
        // --- ALL HELPER FUNCTIONS ---
        
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
                const seconds = (timeRemaining % 60).toString().padStart(2, '0');
                timerEl.textContent = `${minutes}:${seconds}`;
                if (timeRemaining <= 0) {
                    endQuiz();
                }
            }, 1000);
        }

        function endQuiz() {
            clearInterval(timerInterval);
            calculateScore();
            // NEW: Add student to completed list
            completedStudents.push({ stt: selectedStudent.stt, className: classSelect.value });
            showResults();
        }

        function showQuestion(){
            const e=flattenedShuffledQuiz[currentQuestionIndex];
            const t=0===currentQuestionIndex||flattenedShuffledQuiz[currentQuestionIndex-1].partName!==e.partName;
            t?(partNameEl.textContent=e.partName,partInstructionEl.textContent=e.partInstruction,instructionBlock.classList.remove("hidden")):instructionBlock.classList.add("hidden");
            questionNumberEl.textContent=currentQuestionIndex+1;
            questionTextEl.textContent=`C√¢u ${currentQuestionIndex+1}: ${e.question}`;
            optionsContainer.innerHTML="";
            "multiple-choice"===e.type?renderMultipleChoice(e):"true-false"===e.type&&renderTrueFalse(e);
            submitBtn.textContent=currentQuestionIndex===flattenedShuffledQuiz.length-1?"N·ªôp b√†i v√† xem k·∫øt qu·∫£":"Ti·∫øp theo";
            submitBtn.disabled = true; // NEW: Disable button by default
        }

        function renderMultipleChoice(e){e.options.forEach((t,n)=>{const o=document.createElement("button"),s=String.fromCharCode(65+n)+". ";o.textContent=s+t,o.classList.add("w-full","text-left","p-4","border","border-blue-200","rounded-xl","transition-colors","duration-200","quiz-option"),o.onclick=()=>selectMultipleChoiceOption(t,o),userAnswers[currentQuestionIndex]===t&&o.classList.add("selected"),optionsContainer.appendChild(o)})}
        function renderTrueFalse(e){e.options.forEach((t,n)=>{const o=document.createElement("div");o.className="p-4 border border-gray-200 rounded-lg flex justify-between items-center";const s=document.createElement("p");s.className="flex-grow mr-4";const i=String.fromCharCode(97+n)+") ";s.textContent=i+t.text;const a=document.createElement("div");a.className="flex space-x-2 flex-shrink-0";const r=document.createElement("button");r.textContent="ƒê√∫ng",r.className="tf-btn px-4 py-2 rounded-md font-semibold text-sm transition-all duration-200 bg-green-100 text-green-800 hover:bg-green-200",r.onclick=()=>selectTrueFalseOption(n,!0,r,l);const l=document.createElement("button");l.textContent="Sai",l.className="tf-btn px-4 py-2 rounded-md font-semibold text-sm transition-all duration-200 bg-red-100 text-red-800 hover:bg-red-200",l.onclick=()=>selectTrueFalseOption(n,!1,r,l),!0===userAnswers[currentQuestionIndex][n]?r.classList.add("selected"):!1===userAnswers[currentQuestionIndex][n]&&l.classList.add("selected"),a.appendChild(r),a.appendChild(l),o.appendChild(s),o.appendChild(a),optionsContainer.appendChild(o)})}
        
        function selectMultipleChoiceOption(e,t){
            userAnswers[currentQuestionIndex]=e;
            document.querySelectorAll(".quiz-option").forEach(e=>e.classList.remove("selected"));
            t.classList.add("selected");
            submitBtn.disabled = false; // NEW: Enable button
        }

        function selectTrueFalseOption(e,t,n,o){
            userAnswers[currentQuestionIndex][e]=t;
            n.classList.remove("selected");
            o.classList.remove("selected");
            !0===t?n.classList.add("selected"):o.classList.add("selected");
            // NEW: Enable button only if all sub-questions are answered
            if (userAnswers[currentQuestionIndex].every(ans => ans !== null)) {
                submitBtn.disabled = false;
            }
        }

        function handleSubmission(){currentQuestionIndex<flattenedShuffledQuiz.length-1?(currentQuestionIndex++,showQuestion()):endQuiz()}
        function calculateScore(){score=0,flattenedShuffledQuiz.forEach((e,t)=>{if("multiple-choice"===e.type)userAnswers[t]===e.answer&&(score+=.25);else if("true-false"===e.type){let n=0;e.options.forEach((e,o)=>{userAnswers[t][o]===e.answer&&n++}),1===n?score+=.1:2===n?score+=.25:3===n?score+=.5:4===n&&(score+=1)}})}
        function calculateMaxScore(){let e=0;return fullQuizData.forEach(t=>{t.questions.forEach(t=>{"multiple-choice"===t.type?e+=.25:"true-false"===t.type&&(e+=1)})}),e}
        
        function showResults(){
            quizScreen.classList.add("hidden");
            resultScreen.classList.remove("hidden");
            resultStudentNameEl.textContent=`${selectedStudent.stt}. ${selectedStudent.name}`;
            const e=calculateMaxScore();
            scoreEl.textContent=score.toFixed(2);
            maxScoreEl.textContent=e.toFixed(2);
            const t=QUIZ_TIME_SECONDS-timeRemaining;
            const n=Math.floor(t/60);
            const o=t%60;
            timeTakenEl.textContent=`${n} ph√∫t ${o} gi√¢y`;
            displayReview();
            generatePersonalizedFeedback();
        }

        function displayReview(){reviewContainer.innerHTML="",flattenedShuffledQuiz.forEach((e,t)=>{const n=document.createElement("div");n.className="p-4 rounded-lg border";let o=`<p class="font-bold mb-3">C√¢u ${t+1}: ${e.question}</p><div class="space-y-2">`,s=!1;if("multiple-choice"===e.type){s=userAnswers[t]===e.answer,e.options.forEach((n,i)=>{const a=String.fromCharCode(65+i)+". ";let r="review-option p-3 rounded-md border ";n===e.answer?r+="correct":n===userAnswers[t]&&!s&&(r+="incorrect"),o+=`<div class="${r}">${a}${n}</div>`})}else if("true-false"===e.type){const i=userAnswers[t];let a=0;e.options.forEach((e,t)=>{i[t]===e.answer&&a++}),s=a===e.options.length,e.options.forEach((e,t)=>{const n=String.fromCharCode(97+t)+") ",s=i[t],a=e.answer,r=s===a;let l=null===s?"Ch∆∞a ch·ªçn":s?"ƒê√∫ng":"Sai";o+=`<div class="p-3 rounded-md ${r?"bg-green-50":"bg-red-50"}"><p>${n}${e.text}</p><p class="text-xs mt-1">B·∫°n ch·ªçn: <span class="font-bold ${r?"text-green-700":"text-red-700"}">${l}</span>. ƒê√°p √°n: <span class="font-bold text-green-700">${a?"ƒê√∫ng":"Sai"}</span></p></div>`})}o+="</div>",n.innerHTML=o,n.classList.add(s?"border-green-300":"border-red-300"),reviewContainer.appendChild(n)})}
        
        function returnToLogin(){
            startScreen.classList.remove("hidden");
            quizScreen.classList.add("hidden");
            resultScreen.classList.add("hidden");
            
            // Repopulate class list, which will trigger repopulating the name list with filtered students
            populateClassSelect(); 
            classSelect.value = "";
            nameSelect.innerHTML = '<option value="">-- Ch·ªù ch·ªçn l·ªõp --</option>';
            nameSelect.disabled = true;
            startBtn.disabled = true;
        }
        
        function generatePersonalizedFeedback() {
            const topicStats = {};

            flattenedShuffledQuiz.forEach((question, index) => {
                const topic = question.topic || 'Chung';
                if (!topicStats[topic]) {
                    topicStats[topic] = { correct: 0, total: 0 };
                }
                topicStats[topic].total++;

                let isCorrect = false;
                if (question.type === 'multiple-choice') {
                    if (userAnswers[index] === question.answer) isCorrect = true;
                } else if (question.type === 'true-false') {
                    const userChoices = userAnswers[index];
                    if (userChoices.every((choice, i) => choice === question.options[i].answer)) isCorrect = true;
                }
                if (isCorrect) topicStats[topic].correct++;
            });

            const strengths = [], weaknesses = [], needsWork = [];
            for (const topic in topicStats) {
                const percentage = (topicStats[topic].correct / topicStats[topic].total) * 100;
                if (percentage >= 75) strengths.push(topic);
                else if (percentage < 50) weaknesses.push(topic);
                else needsWork.push(topic);
            }

            let feedbackHTML = '';
            if (strengths.length > 0) {
                feedbackHTML += `<div class="p-3 rounded-md bg-green-50 border border-green-200">
                    <h4 class="font-bold text-green-800">‚úÖ ∆Øu ƒëi·ªÉm</h4>
                    <p class="mt-1 text-green-700">Ch√∫c m·ª´ng! B·∫°n ƒë√£ th·ªÉ hi·ªán s·ª± am hi·ªÉu s√¢u s·∫Øc v·ªÅ c√°c ch·ªß ƒë·ªÅ: <strong>${strengths.join(', ')}</strong>. H√£y ti·∫øp t·ª•c ph√°t huy nh√©.</p>
                </div>`;
            }
             if (needsWork.length > 0) {
                feedbackHTML += `<div class="p-3 rounded-md bg-yellow-50 border border-yellow-200">
                    <h4 class="font-bold text-yellow-800">‚ö†Ô∏è C·∫ßn c·ªßng c·ªë</h4>
                    <p class="mt-1 text-yellow-700">B·∫°n ƒë√£ c√≥ ki·∫øn th·ª©c n·ªÅn t·∫£ng nh∆∞ng c·∫ßn c·ªßng c·ªë th√™m ·ªü c√°c ch·ªß ƒë·ªÅ: <strong>${needsWork.join(', ')}</strong>. H√£y √¥n t·∫≠p l·∫°i ƒë·ªÉ n·∫Øm ch·∫Øc h∆°n.</p>
                </div>`;
            }
            if (weaknesses.length > 0) {
                 feedbackHTML += `<div class="p-3 rounded-md bg-red-50 border border-red-200">
                    <h4 class="font-bold text-red-800">‚ùå Nh∆∞·ª£c ƒëi·ªÉm</h4>
                    <p class="mt-1 text-red-700">B·∫°n c·∫ßn t·∫≠p trung √¥n luy·ªán k·ªπ h∆°n c√°c ch·ªß ƒë·ªÅ sau ƒë√¢y v√¨ k·∫øt qu·∫£ ch∆∞a t·ªët: <strong>${weaknesses.join(', ')}</strong>.</p>
                </div>`;
            }
            feedbackHTML += `<div class="p-3 rounded-md bg-blue-50 border border-blue-200">
                <h4 class="font-bold text-blue-800">üìö G·ª£i √Ω l·ªô tr√¨nh h·ªçc t·∫≠p</h4>
                <p class="mt-1 text-blue-700">ƒê·ªÉ c·∫£i thi·ªán k·∫øt qu·∫£, b·∫°n n√™n ∆∞u ti√™n xem l·∫°i c√°c ph·∫ßn ki·∫øn th·ª©c ·ªü m·ª•c "Nh∆∞·ª£c ƒëi·ªÉm" v√† "C·∫ßn c·ªßng c·ªë". H√£y th·ª≠ l√†m l·∫°i c√°c c√¢u ƒë√£ sai v√† t√¨m th√™m c√°c b√†i t·∫≠p t∆∞∆°ng t·ª± ƒë·ªÉ th·ª±c h√†nh. Vi·ªác luy·ªán t·∫≠p th∆∞·ªùng xuy√™n l√† ch√¨a kh√≥a ƒë·ªÉ th√†nh c√¥ng!</p>
            </div>`;

            feedbackContainer.innerHTML = feedbackHTML;
        }

        function getResultSummary() {
            const maxScore = calculateMaxScore();
            const timeText = timeTakenEl.textContent;
            return `${selectedStudent.name}\tL·ªõp: ${classSelect.value}\t${timeText}\t${score.toFixed(2)} / ${maxScore.toFixed(2)}`;
        }

        function copyResult() {
            const summary = getResultSummary();
            const textArea = document.createElement("textarea");
            // Prevent scrolling
            textArea.style.position = 'fixed';
            textArea.style.top = '-9999px';
            textArea.style.left = '-9999px';
            
            textArea.value = summary;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copySuccess.classList.remove('hidden');
                setTimeout(() => copySuccess.classList.add('hidden'), 3000);
            } catch (err) {
                console.error('Kh√¥ng th·ªÉ sao ch√©p', err);
            }
            document.body.removeChild(textArea);
        }
        
        // Event Listeners
        classSelect.addEventListener('change', handleClassChange);
        nameSelect.addEventListener('change', handleNameChange);
        startBtn.addEventListener('click', startQuiz);
        submitBtn.addEventListener('click', handleSubmission);
        copyBtn.addEventListener('click', copyResult);
        endQuizBtn.addEventListener('click', returnToLogin);

        // Initial Load
        populateClassSelect();
    </script>
</body>
</html>
